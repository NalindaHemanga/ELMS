<link rel="stylesheet" type="text/css" href="css/leftnav.css" />
<link rel="stylesheet" type="text/css" href="css/category_tree.css" />
<link rel="stylesheet" type="text/css" href="css/item.css" />
<link rel="stylesheet" type="text/css" href="css/button.css" />
<div id="leftcolumnwrap">
        	<div id="leftcolumn" >
		<div id="" style="overflow-y:auto; height:400px;">
		<ul class="leftnav">
		<li class="leftnav" ><a class="home" href="home.php"><font color="#b5dfeb" size="4" face="Agency FB">Categories</font></a></li>
		</ul>
				<ol class="tree">
					<?php
					/*me php kellen wenne category tree eka hadenna ona html code eka genarate wena eka*/
					require 'includes/CategoryTree/category_tree_editable.php'; 
					/*category_tree.php eke thiyenne categories monawada kiyala database eken balala ekata anuwa tree ekata enna ona html code tika echo(print) karana "collapseTree" kiyala funtion ekak.*/ 
					
					foreach ($catagories as $catagory6){
						if ($catagory6->get_parent() == (NULL||0)){
						collapseTree($catagory6, $catagories);
						}
					}
					
					?>
					<div id=mainCat>
					
					</div>
				</ol>
		</div>

<div id="selectedCat">
Selected category 
<div id="selectedCatLbl">None</div>
</div>

<div id="addNewCat">
<a class="button icon chat" id="addNewCat" onclick="addNewCat()"><span>Add new</span></a>
</div>

<div id= "dltCat">

<a class="button icon chat" disabled><span>Delete</span></a>
</div>

<div id= "editCat">
<a class="button icon chat"><span>Edit</span></a>
</div>


<div id= "submitCat">

</div>
            
       		</div>
</div>


<script type="text/javascript">
var cat_ID = 0;
var cat_NAME;
var cat_ID_new_division = "mainCat";

function catCliked(cat_id,name)
{
	loadXMLDoc(cat_id)
	newCatCancel();
	cat_ID = cat_id;
	cat_NAME = name;
	document.getElementById("selectedCatLbl").innerHTML=name;
	cat_ID_new_division = cat_id + ".1"
	var w= "";
	w+= '<a class="button icon chat" id="dltCatBtn" onclick="dltCatBtn()"><span>Delete</span></a>';
	document.getElementById("dltCat").innerHTML=w;
	var x= "";
	x+= '<a class="button icon chat" id="editCatBtn" onclick="editCat()"><span>Edit</span></a>';
	document.getElementById("editCat").innerHTML=x;
	document.getElementById("editCatTxt").innerHTML="";
}

function addNewCat()
{
    var s= "";
    s+= '<input type="text" name="Fname" id="'+cat_ID_new_division+'name" required>'; //Create one textbox as HTML
    document.getElementById(cat_ID_new_division).innerHTML=s;
	var t= "";
	t+= '<a class="button icon chat" id="submit_cat" onclick="submitNewCat()"><span>Add</span></a>';
	document.getElementById("submitCat").innerHTML=t;
	var u= "";
	u+= '<a class="button icon chat" id="addNewCat" onclick="newCatCancel()"><span>Cancel</span></a>';
	document.getElementById("addNewCat").innerHTML=u;
	document.getElementById("dltCat").innerHTML="";
	document.getElementById("editCat").innerHTML="";
}

function submitNewCat()
{
	var newCatTxtId = cat_ID_new_division+"name";
	var newCatTxtValue = document.getElementById(newCatTxtId).value
	var dataString = 'parent1='+ cat_ID + '&cat_name1='+ newCatTxtValue;	
		
$.ajax({
type: "POST",
url: "submit_cat.php",
data: dataString,
cache: false,
success: function(result){
alert(result);}
});
setTimeout(function(){reloadpg();},100);
}

function newCatCancel()
{
	document.getElementById(cat_ID_new_division).innerHTML="";
	document.getElementById("submitCat").innerHTML="";
	var v= "";
	v+= '<a class="button icon chat" id="addNewCat" onclick="addNewCat()"><span>Add New</span></a>';
	document.getElementById("addNewCat").innerHTML=v;
}

function deleteCat()
{
    if (confirm("Are you sure that you want to delete this category? " + cat_NAME) == true) {
        var dataString = 'CatId='+ cat_ID + '&cat_name='+ cat_NAME;
	$.ajax({
	type: "POST",
	url: "delete_cat.php",
	data: dataString,
	cache: false,
	success: function(result){
	}
	});
	setTimeout(function(){reloadpg();},100);
    } else {
        
    }
}

function editCat()
{
    var y= "";
    y+= '<input type="text" name="editCatName" id="editCatNameTxtbx" value="'+cat_NAME+'"required>'; //Create one textbox as HTML
    document.getElementById("selectedCatLbl").innerHTML=y;
    document.getElementById("editCat").innerHTML='<button type="button" id="doneEditCatBtn" style="float: right;" onclick="submitEditedCat()">Done</button>';
    document.getElementById("addNewCat").innerHTML='<button type="button" style="float: right;" disabled>Add new</button>';
    document.getElementById("dltCat").innerHTML='<button type="button" style="float: right;" disabled>Delete</button>';
}

function submitEditedCat()
{
    if (confirm("Are you sure that you want to change the category " + cat_NAME + "?") == true) {
	var editedCatName = document.getElementById("editCatNameTxtbx").value;
        var dataString = 'CatId='+ cat_ID + '&edited_cat_name='+ editedCatName;
	$.ajax({
	type: "POST",
	url: "edit_cat.php",
	data: dataString,
	cache: false,
	success: function(result){
	}
	});
	setTimeout(function(){reloadpg();},100);
    } else {
        
    }
}

function reloadpg()
{
location.reload();
}

function addItemForm()
{
	var send = "addItemUI.php?cat_id="+cat_ID+"&cat_name="+cat_NAME;
	window.location = send;

}


function loadXMLDoc(cat_id)
{
var xmlhttp;
if (window.XMLHttpRequest)
  {// code for IE7+, Firefox, Chrome, Opera, Safari
  xmlhttp=new XMLHttpRequest();
  }
else
  {// code for IE6, IE5
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
xmlhttp.onreadystatechange=function()
  {
  if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
    document.getElementById("content").innerHTML=xmlhttp.responseText;
    }
  }
 xmlhttp.open("GET", "itemViewerEditable.php?cat_id=" + cat_id, true);
        xmlhttp.send();
}


function addItemSubmit() {
var nic_no = document.getElementById("nic_no").value;
var item_type = document.getElementById("item_type").value;
var item_desc = document.getElementById("item_desc").value;
var item_tec_desc = document.getElementById("item_tec_desc").value;
// Returns successful data submission message when the entered information is stored in database.
var dataString = "nic_no1=" + nic_no + "&item_type1=" + item_type + "&item_desc1=" + item_desc + "&item_tec_desc1=" + item_tec_desc;

// AJAX code to submit form.
$.ajax({
type: "POST",
url: "submit_item.php",
data: dataString,
cache: false,
success: function(html) {
alert(html);
}
});

return false;
}



</script>
